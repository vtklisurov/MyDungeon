<!DOCTYPE html>
<head>
  <style>
  select{
    margin-bottom: 10px;
  }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/janl/mustache.js/master/mustache.js"></script>
  <script>
  $(document).ready(function(){
    try{
      $.post('/fillDropdowns', function(res){

        var temp = $('#payTemp').html();
        var html = Mustache.render(temp, res);
        document.getElementById('paymentType').innerHTML=html;

        var temp = $('#addrTemp').html();
        var html = Mustache.render(temp, res);
        document.getElementById('address').innerHTML=html;

      })
    } catch(err) {
      body.innerHTML="Error with the database";
    }
  });

  function placeOrder(){
    $.post('/checkStock', function(){
      if (status!=='Ok'){
        alert(status);
        return;
      } else {
        window.location.href='/cart';
      }
    })
    if (document.getElementById('paymentType').value=='1'){

    } else if (document.getElementById('paymentType').value=='2'){

    } else {
      $.post('/placeOrder', $('#input').serialize() ,function(status){
        //alert(status);
        window.location.href='/';
      })
    }
  }

  </script>

  <script type="text/template" id="payTemp">
    {{#types}}
    <option value="{{type}}">{{meaning}}</option>
    {{/types}}
  </script>

  <script type="text/template" id="addrTemp">
    {{#addresses}}
    <option value="{{id}}">{{country}},{{city}},{{postal}},{{str_address}}</option>
    {{/addresses}}
  </script>

</head>
<body>
  <form id='input' action='/placeOrder' method='post'>
    <label>Select payment type:</label>
    <select id="paymentType" name='type'></select><br>
    <label>Select address:</label>
    <select id="address" name='addr'></select><br>
    <input type='submit' id="buy" onclick="placeOrder()" value='Buy'>
  </form>
</body>
